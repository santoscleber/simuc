<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Visualizador de Imagens GOES-19</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { margin: 0; font-family: Arial, sans-serif; }
    #goes19Image { width: 100%; max-height: 600px; display: none; }
    .controls {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 1000;
      background: white;
      padding: 15px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      max-width: 280px;
    }
    .controls label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    .controls select {
      width: 100%;
      padding: 5px;
      margin-bottom: 10px;
    }
    .status {
      font-size: 12px;
      color: #666;
      margin-bottom: 10px;
    }
    .info {
      font-size: 11px;
      color: #888;
      line-height: 1.3;
    }
  </style>
</head>
<body>

<div class="controls">
  <label for="sectorSelect">Selecionar Setor:</label>
  <select id="sectorSelect">
    <option value="CONUS/GEOCOLOR">CONUS - GeoColor</option>
    <option value="FullDisk/GEOCOLOR">Full Disk - GeoColor</option>
    <option value="Meso1/GEOCOLOR">Meso 1 - GeoColor</option>
    <option value="Meso2/GEOCOLOR">Meso 2 - GeoColor</option>
    <option value="SouthAmerica_north/GEOCOLOR">América do Sul (Norte) - GeoColor</option>
    <option value="SouthAmerica_south/GEOCOLOR">América do Sul (Sul) - GeoColor</option>
  </select>
  <div class="status" id="status">Carregando imagem GOES-19...</div>
  <div class="info">
    <strong>Sobre as imagens:</strong><br>
    • GOES-19: Satélite geoestacionário da NOAA<br>
    • Imagens: Bandas ABI (GeoColor)<br>
    • Fonte: NOAA NESDIS<br>
    • Data: <span id="dateInfo"></span>
  </div>
</div>

<img id="goes19Image" src="" alt="Imagem GOES-19" />
<img id="fallbackImage" src="https://via.placeholder.com/800x600?text=Imagem+GOES-19+Indisponível" alt="Imagem de Fallback" style="display: none; width: 100%; max-height: 600px;" />

<script>
  var goes19Image = document.getElementById('goes19Image');
  var fallbackImage = document.getElementById('fallbackImage');
  var statusDiv = document.getElementById('status');
  var dateInfoDiv = document.getElementById('dateInfo');
  var sectorSelect = document.getElementById('sectorSelect');

  // Função para gerar a data/hora no formato do nome do arquivo
  function getCurrentDateTime() {
    const now = new Date();
    const year = now.getFullYear();
    const dayOfYear = String(Math.floor((now - new Date(year, 0, 1)) / (1000 * 60 * 60 * 24)) + 1).padStart(3, '0');
    const hours = String(now.getUTCHours()).padStart(2, '0');
    const minutes = String(Math.floor(now.getUTCMinutes() / 5) * 5).padStart(2, '0'); // Arredonda para o múltiplo de 5 mais próximo
    const dateStr = `${year}${dayOfYear}${hours}${minutes}`;
    dateInfoDiv.textContent = `${year}-${String(now.getUTCMonth() + 1).padStart(2, '0')}-${String(now.getUTCDate()).padStart(2, '0')} ${hours}:${minutes} UTC`;
    return dateStr;
  }

  // Função para carregar a imagem do GOES-19
  function loadGoes19Image(sector) {
    const dateTime = getCurrentDateTime();
    const imageUrl = `https://cdn.star.nesdis.noaa.gov/GOES19/ABI/${sector}/${dateTime}_GOES19-ABI-${sector.replace('/', '-')}-1000x1000.jpg`;

    statusDiv.textContent = `Carregando imagem GOES-19 (${sector})...`;
    statusDiv.style.color = '#666';

    // Testar se a imagem está disponível
    fetch(imageUrl, { method: 'HEAD' })
      .then(response => {
        if (response.ok) {
          goes19Image.src = imageUrl;
          goes19Image.style.display = 'block';
          fallbackImage.style.display = 'none';
          statusDiv.textContent = 'Imagem carregada com sucesso!';
          statusDiv.style.color = 'green';
        } else {
          showFallback();
        }
      })
      .catch(error => {
        console.error('Erro ao carregar imagem:', error);
        showFallback();
      });
  }

  // Função para exibir imagem de fallback
  function showFallback() {
    statusDiv.textContent = 'Erro: Imagem GOES-19 indisponível. Verifique o status em https://www.ospo.noaa.gov/Operations/messages.html ou tente outro setor.';
    statusDiv.style.color = 'red';
    goes19Image.style.display = 'none';
    fallbackImage.style.display = 'block';
  }

  // Event listener para o seletor de setores
  sectorSelect.addEventListener('change', function(e) {
    loadGoes19Image(e.target.value);
  });

  // Carregar a imagem inicial
  loadGoes19Image(sectorSelect.value);
</script>

</body>
</html>