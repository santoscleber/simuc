<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Dias Extremos - BelÃ©m</title>
  <link rel="shortcut icon" href="../../principal/imagens/logo.ico" type="image/x-icon">
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      background: white;
      color: black;
      text-align: center;
      font-family: sans-serif;
      margin: 20px;
    }
    h2 {
      margin-top: 40px;
    }
    .chart {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>VisualizaÃ§Ã£o de Dias Extremos - BelÃ©m</h1>

  <h2>Heatmap de Dias Extremos (Ano Ã— MÃªs)</h2>
  <div id="heatmap" class="chart"></div>

  <h2>Acumulado de Dias Extremos por Ano</h2>
  <div id="line_ano" class="chart"></div>

  <h2>Acumulado de Dias Extremos por MÃªs em 2025</h2>
  <div id="line_2025" class="chart"></div>

  <script>
    // --------------------------------------------------------
    // ðŸ‘‰ Aqui vocÃª coloca o caminho para o seu CSV
    // Exemplo: "../../ERA5_dias_extremos_99p_1970_2025_belem.csv"
    // --------------------------------------------------------
    const caminhoCSV = "../../ERA5_dias_extremos_99p_1970_2025_belem.csv";

    // Carregar o CSV
    d3.csv(caminhoCSV).then(function(data) {
      data.forEach(d => {
        d.year = +d.year;
        d.month = +d.month;
        d.dias_extremos = +d.dias_extremos;
      });

      // --------------------------------------------------------
      // Heatmap (Ano Ã— MÃªs)
      // --------------------------------------------------------
      const anos = [...new Set(data.map(d => d.year))].sort((a,b)=>a-b);
      const meses = [1,2,3,4,5,6,7,8,9,10,11,12];
      const nomesMeses = ['Jan','Fev','Mar','Abr','Mai','Jun',
                          'Jul','Ago','Set','Out','Nov','Dez'];

      const z = meses.map(m => 
        anos.map(a => {
          const row = data.find(d => d.year === a && d.month === m);
          return row ? row.dias_extremos : 0;
        })
      );

      Plotly.newPlot('heatmap', [{
        z: z,
        x: anos,
        y: nomesMeses,
        type: 'heatmap',
        colorscale: 'Reds',
        zmin: 0,
        zmax: 31,
        colorbar: { title: 'Dias extremos' }
      }], {
        margin: { t: 40 },
        title: "Heatmap de Dias Extremos (Ano Ã— MÃªs)",
        xaxis: { title: "Ano" },
        yaxis: { title: "MÃªs" }
      });

      // --------------------------------------------------------
      // GrÃ¡fico de linhas - Acumulado por ano
      // --------------------------------------------------------
      const porAno = {};
      data.forEach(d => {
        porAno[d.year] = (porAno[d.year] || 0) + d.dias_extremos;
      });

      Plotly.newPlot('line_ano', [{
        x: Object.keys(porAno),
        y: Object.values(porAno),
        type: 'scatter',
        mode: 'lines+markers',
        line: { color: 'red' },
        marker: { size: 6 }
      }], {
        margin: { t: 40 },
        title: "Acumulado de Dias Extremos por Ano",
        xaxis: { title: "Ano" },
        yaxis: { title: "NÃºmero de dias extremos" }
      });

      // --------------------------------------------------------
      // GrÃ¡fico de linhas - Acumulado por mÃªs de 2025
      // --------------------------------------------------------
      const dados2025 = data.filter(d => d.year === 2025)
                            .sort((a,b)=>a.month-b.month);

      Plotly.newPlot('line_2025', [{
        x: dados2025.map(d => nomesMeses[d.month-1]),
        y: dados2025.map(d => d.dias_extremos),
        type: 'scatter',
        mode: 'lines+markers',
        line: { color: 'orange' },
        marker: { size: 6 }
      }], {
        margin: { t: 40 },
        title: "Acumulado de Dias Extremos por MÃªs em 2025",
        xaxis: { title: "MÃªs" },
        yaxis: { title: "NÃºmero de dias extremos" }
      });

    }).catch(error => {
      console.error("Erro ao carregar o CSV:", error);
      alert("NÃ£o foi possÃ­vel carregar o arquivo CSV. Verifique o caminho.");
    });
  </script>
</body>
</html>
